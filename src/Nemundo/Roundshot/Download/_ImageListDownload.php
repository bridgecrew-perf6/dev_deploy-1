<?phpnamespace Nemundo\Roundshot\Download;use Nemundo\Core\Base\AbstractBase;use Nemundo\Core\Json\Reader\JsonReader;use Nemundo\Core\Type\DateTime\Date;use Nemundo\Core\Type\DateTime\DateTime;use Nemundo\Core\File\File;use Nemundo\Core\Type\Text\Text;use Nemundo\Core\WebRequest\WebRequest;use Nemundo\Roundshot\Data\Roundshot\RoundshotRow;use Nemundo\Roundshot\Data\RoundshotImage\RoundshotImage;use Nemundo\Roundshot\Path\RoundshotCachePath;class ImageListDownload extends AbstractBase{    /**     * @var RoundshotRow     */    public $roundshotRow;    /**     * @var Date     */    public $date;    /**     * @var bool     */    public $downloadImage = false;    public function download()    {        $datumText = $this->date->getIsoDate();        $text = new Text();        $text->append($this->roundshotRow->url);        $text->append('structure.json?days=0&to=');        $text->append($datumText);        $text->append('T23%3A59%3A59.999Z');        $url = $text->getValue();        $jsonReader = new JsonReader();        $jsonReader->fromUrl($url);        foreach ($jsonReader->getData()['images'] as $image) {            $timestamp = $image['datetime'];            $dateTime = (new DateTime())->fromTimestamp($timestamp);            $halfUrl = $image['structure']['half']['url_full'];            if ($this->downloadImage) {                $timeText = (new Text($dateTime->getIsoTime()))->replace(':', '_')->getValue();                $filename = (new RoundshotCachePath())                    ->addPath($this->roundshotRow->id)                    ->addPath($this->date->getIsoDate())                    ->createPath()                    ->addPath($timeText . '.jpg')                    ->getFilename();                if ((new File($filename))->notExists()) {                    $webRequest = new WebRequest();                    $webRequest->downloadUrl($halfUrl, $filename);                }            }            $data = new RoundshotImage();            $data->ignoreIfExists = true;            $data->roundshotId = $this->roundshotRow->id;            $data->date = $this->date;            $data->time = $dateTime->getTime();            $data->url = $halfUrl;            $data->save();        }        /*        $update = new RoundshotDownloadUpdate();        $update->download = true;        $update->filter->andEqual($update->model->roundshotId, $this->roundshotId);        $update->filter->andEqual($update->model->date, $this->date->getIsoDateFormat());        $update->update();*/    }}