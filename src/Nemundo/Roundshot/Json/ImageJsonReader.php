<?phpnamespace Nemundo\Roundshot\Json;use Nemundo\Core\Base\DataSource\AbstractDataSource;use Nemundo\Core\Debug\Debug;use Nemundo\Core\Json\Reader\JsonReader;use Nemundo\Core\Type\DateTime\Date;use Nemundo\Core\Type\DateTime\DateTime;use Nemundo\Core\File\File;use Nemundo\Core\Type\Text\Text;use Nemundo\Core\WebRequest\WebRequest;use Nemundo\Roundshot\Data\Roundshot\RoundshotRow;use Nemundo\Roundshot\Data\RoundshotImage\RoundshotImage;use Nemundo\Roundshot\Path\RoundshotCachePath;class ImageJsonReader extends AbstractDataSource{    /**     * @var RoundshotRow     */    public $roundshotRow;    /**     * @var Date     */    public $date;    protected function loadData()    {        $datumText = $this->date->getIsoDate();        //(new Debug())->write($datumText);        $text = new Text();        $text->append($this->roundshotRow->url);        $text->append('structure.json?days=0&to=');        $text->append($datumText);        $text->append('T23%3A59%3A59.999Z');        $url = $text->getValue();        //(new Debug())->write($url);        //exit;        $jsonReader = new JsonReader();        $jsonReader->fromUrl($url);        $jsonReader->reverse=true;        foreach ($jsonReader->getData()['images'] as $image) {            $timestamp = $image['datetime'];            $dateTime = (new DateTime())->fromTimestamp($timestamp);            $halfUrl = $image['structure']['half']['url_full'];            $item=new RoundshotImageItem();            $item->imageUrl = $halfUrl;            $item->dateTime=$dateTime;            $this->addItem($item);            /*if ($this->downloadImage) {                $timeText = (new Text($dateTime->getIsoTime()))->replace(':', '_')->getValue();                $filename = (new RoundshotCachePath())                    ->addPath($this->roundshotRow->id)                    ->addPath($this->date->getIsoDateFormat())                    ->createPath()                    ->addPath($timeText . '.jpg')                    ->getFilename();                if ((new File($filename))->notExists()) {                    $webRequest = new WebRequest();                    $webRequest->downloadUrl($halfUrl, $filename);                }            }            $data = new RoundshotImage();            $data->ignoreIfExists = true;            $data->roundshotId = $this->roundshotRow->id;            $data->date = $this->date;            $data->time = $dateTime->getTime();            $data->url = $halfUrl;            $data->save();*/        }    }    /**     * @return RoundshotImageItem[]     */    public function getData()    {        return parent::getData();    }}