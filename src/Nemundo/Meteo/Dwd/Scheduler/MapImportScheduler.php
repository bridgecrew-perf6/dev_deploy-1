<?phpnamespace Nemundo\Meteo\Dwd\Scheduler;use Nemundo\App\Scheduler\Job\AbstractScheduler;use Nemundo\Core\File\UniqueFilename;use Nemundo\Core\File\File;use Nemundo\Core\WebRequest\WebRequest;use Nemundo\Meteo\Dwd\Data\Map\MapReader;use Nemundo\Meteo\Dwd\Data\MapImage\MapImage;use Nemundo\Meteo\Dwd\Data\MapImage\MapImageCount;use Nemundo\Meteo\Dwd\Path\DwdTmpPath;class MapImportScheduler extends AbstractScheduler{    protected function loadScheduler()    {        $this->active = true;        $this->hour = 1;        $this->consoleScript = true;        $this->scriptName = 'dwd-import';    }    public function run()    {        (new DwdTmpPath())->createPath();        $reader = new MapReader();        foreach ($reader->getData() as $mapRow) {            $filename = (new DwdTmpPath())                ->addPath((new UniqueFilename())->getUniqueFilename('png'))                ->getFilename();            $download = new WebRequest();            $download->downloadUrl($mapRow->mapUrl, $filename);            $file = new File($filename);            $hash = $file->getHash();            $count = new MapImageCount();            $count->filter->andEqual($count->model->hash, $hash);            if ($count->getCount() == 0) {                $data = new MapImage();                $data->mapId = $mapRow->id;                $data->image->fromFilename($filename);                $data->hash = $hash;                $data->save();            }            $file->deleteFile();        }    }}