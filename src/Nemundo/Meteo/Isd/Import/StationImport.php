<?phpnamespace Nemundo\Meteo\Isd\Import;use Nemundo\Core\Base\AbstractImport;use Nemundo\Core\Csv\CsvSeperator;use Nemundo\Core\Csv\Reader\CsvReader;use Nemundo\Core\Type\DateTime\Date;use Nemundo\Meteo\Base\Download\FileDownload;use Nemundo\Meteo\Isd\Data\Station\StationBulk;use Nemundo\Meteo\Isd\Data\Station\StationUpdate;use Nemundo\Meteo\Isd\Store\CountryStore;use Nemundo\Meteo\Isd\Utility\SixDigitDate;class StationImport extends AbstractImport{    public function importData()    {        $countryStore = new CountryStore();        $download = new FileDownload();        $download->url = 'ftp://ftp.ncdc.noaa.gov/pub/data/noaa/isd-history.csv';        $download->filename = 'isd-history.csv';        $filename = $download->downloadFile();        $data = new StationBulk();        $data->ignoreIfExists = true;        $csvReader = new CsvReader();        $csvReader->filename = $filename;        $csvReader->separator = CsvSeperator::COMMA;        foreach ($csvReader->getData() as $csvRow) {            $stationId = $csvRow->getValue('usaf');            $data->id = $stationId;            $data->active = false;            $data->stationCode = $csvRow->getValue('usaf');            $data->station = $csvRow->getValue('station name');            $data->coordinate->latitude = $csvRow->getValue('LAT');            $data->coordinate->longitude = $csvRow->getValue('LON');            $data->coordinate->altitude = $csvRow->getValue('ELEV(M)');            $data->countryId = $countryStore->getId($csvRow->getValue('ctry'));            $data->validFrom = (new SixDigitDate())->fromSixDigit($csvRow->getValue('begin'));            $data->validTo = (new SixDigitDate())->fromSixDigit($csvRow->getValue('end'));            $data->save();        }        $data->saveBulk();        $update = new StationUpdate();        $update->active = false;        $update->update();        $update = new StationUpdate();        $update->filter->andEqualOrGreater($update->model->validTo, (new Date())->setNow()->minusDay(14)->getIsoDate());        $update->active = true;        $update->update();    }}